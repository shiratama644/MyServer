このドキュメントでは、Proxmox VE上で動作しているLXCコンテナやKVM仮想マシンに、使い慣れたローカルPCのVisual Studio CodeからSSH接続し、まるでローカルファイルを扱うかのように快適に開発・編集する方法を解説します。

### なぜVS Code + Remote SSHなのか？

- **快適な開発環境:** ローカルPCのVS Codeで、コード補完、シンタックスハイライト、Git連携などの全機能をそのまま利用できます。
- **ターミナルの統合:** VS Code内で開くターミナルは、自動的に接続先（LXC/KVM）のシェルになり、シームレスにコマンドを実行できます。
- **簡単なファイル操作:** エクスプローラーからファイルやフォルダの作成、名前の変更、削除が直感的に行えます。
- **一元管理:** 複数のLXC/KVMへの接続情報を保存し、簡単に切り替えることができます。

---

### ステップ1: 【事前準備】 接続先（LXC/KVM）での設定

この手順は、接続したいすべてのLXCコンテナとKVM仮想マシンで、それぞれ初回に一度だけ行います。

#### 1. コンソールでゲストOSにログインする

まず、Proxmox VEのWebインターフェースから対象のゲストOSにアクセスします。

- 左のツリーから対象のLXC/KVMを選択します。
- 右側のメニューから `>_ Console` をクリックします。
- `root`ユーザーと、OSインストール時（またはコンテナ作成時）に設定したパスワードでログインします。

#### 2. SSHサーバーをインストールする

多くのOSテンプレートでは、SSHサーバーがデフォルトでインストールされていないか、有効になっていません。

```bash
# Debian / Ubuntu系の場合 (LXCテンプレートの多くはこの系統です)
apt update
apt install -y openssh-server

# SSHサービスが自動起動するように設定
systemctl enable ssh
systemctl start ssh
```

#### 3. （強く推奨）作業用の一般ユーザーを作成する

セキュリティ上、`root`ユーザーで直接SSH接続するのは非推奨です。作業用のユーザーを作成し、必要に応じて`sudo`（管理者権限）を付与しましょう。

```bash
# "devuser"という名前のユーザーを作成 (名前は任意)
# パスワードなどを聞かれるので設定してください
adduser devuser

# 作成したユーザーにsudo権限を付与する
usermod -aG sudo devuser
```

#### 4. IPアドレスを確認する

接続先のLXC/KVMのIPアドレスを調べます。

- **Proxmox VEのWeb UIで確認:**
  対象のLXC/KVMを選択し、「サマリー」画面の「IPs」欄で確認できます。

- **コンソール内で確認:**
  コンソールで以下のコマンドを実行します。
  ```bash
  ip a
  ```

---

### ステップ2: 【事前準備】 自分のPC（クライアント側）での設定

1. **Visual Studio Codeのインストール:**
   [公式サイト](https://code.visualstudio.com/)からダウンロードしてインストールします。

2. **Remote - SSH 拡張機能のインストール:**
   - VS Codeを起動します。
   - 左側のアクティビティバーから、四角が並んだ「拡張機能」アイコンをクリックします。
   - 検索バーに `Remote - SSH` と入力します。
   - Microsoft提供のものを選択し、「インストール」をクリックします。

---

### ステップ3: VS CodeからLXC/KVMへ接続する

#### 1. SSH接続先を追加する

- VS Codeの左下隅にある緑色の `><` アイコンをクリックします。
- 上部に表示されるメニューから **「Connect to Host...」** を選択します。
- **「+ Add New SSH Host...」** を選択します。
- 入力欄に、以下の形式で接続情報を入力し、Enterキーを押します。
  ```
  ssh <ステップ1で作成したユーザー名>@<LXC/KVMのIPアドレス>
  
  # 例: ssh devuser@192.168.1.101
  ```
- SSH設定ファイルの保存場所を聞かれるので、デフォルトの場所（一番上）を選択してEnterキーを押します。
- 右下に「Host added!」と通知が表示されたら成功です。

#### 2. 接続を実行する

- 再度、左下の緑色のアイコン `><` をクリックし、**「Connect to Host...」** を選択します。
- 今追加したホスト（例: `devuser@192.168.1.101`）が表示されるので、それをクリックします。
- 新しいVS Codeウィンドウが開き、接続が開始されます。
- 初回接続時には、OSの種類を聞かれるので **「Linux」** を選択し、その後パスワードを求められたら入力します。

接続が成功すると、左下の緑色のアイコンの表示が `SSH: <IPアドレス>` に変わります。

---

### ステップ4: リモートのファイルを編集・操作する

#### 1. プロジェクトフォルダーを開く

- VS Codeのメニューバーから「ファイル」→「フォルダーを開く...」(File > Open Folder...) を選択します。
- 接続先（LXC/KVM）のファイルシステムが表示されるので、編集したいプロジェクトのディレクトリ（例: `/srv/app`）を選択して「OK」をクリックします。
- 再度パスワードを求められる場合があります。

#### 2. 編集とターミナル操作

- VS Codeの左側エクスプローラーに、リモートのファイルやディレクトリが表示されます。
- ファイルをクリックすれば、ローカルファイルを編集するのとまったく同じ感覚でコードを書くことができます。
- VS Codeのメニューバーから「ターミナル」→「新しいターミナル」を開くと、それは**SSH接続先のシェル**になっています。`npm install` や `git pull` などのコマンドを直接実行でき、非常に便利です。

以上で、LXC/KVM内のファイルを快適に編集する環境が整いました。