このドキュメントは、サーバーのパフォーマンス向上とデータベース負荷軽減のため、各サービスにRedisキャッシュを導入する際の戦略と実装方法を定めるものです。

### 基本方針：キャッシュアサイド (Cache-Aside) パターン

すべてのキャッシュ実装は、以下の「キャッシュアサイド」パターンを基本とします。

1.  **クライアントからのリクエスト**
2.  **まずRedisキャッシュにデータがあるか確認**する。
3.  **【キャッシュヒット】** データがあれば、Redisからデータを取得してクライアントに返す。（処理完了）
4.  **【キャッシュミス】** データがなければ、**データベース (DB) や外部API**からデータを取得する。
5.  取得したデータを**Redisに保存**する。（次回のリクエストに備える）
6.  クライアントにデータを返す。

### 前提：Redisクライアントの準備

各アプリケーションでは、以下のようにRedisクライアントを初期化して、使い回せるようにモジュール化しておきます。

---

### 1. YouTubeプロキシ (ProxTube)

#### 1.1. キャッシュ対象
- **YouTube APIからの検索結果:** ユーザーが同じキーワードで検索した際の結果。
- **YouTube APIからの動画メタデータ:** 動画タイトル、説明、サムネイルなどの詳細情報。

#### 1.2. キャッシュ戦略
- **目的:** 外部APIへのアクセス回数を減らし、応答速度を向上させる。
- **TTL (Time To Live / 有効期間):**
    - **検索結果:** 流行が変わりやすいため、短めの **1時間 (3600秒)** に設定。
    - **動画メタデータ:** 内容がほぼ変わらないため、長めの **12時間 (43200秒)** に設定。
- **キャッシュの更新:** TTLが切れたら自動的に削除されるため、次のアクセス時に最新のデータがAPIから取得され、キャッシュが更新される。積極的な削除は不要。

### 2. CPUランキングサイト (CPURanking)

#### 2.1. キャッシュ対象
- **ランキングトップページに表示されるCPU性能ランキング一覧。**

#### 2.2. キャッシュ戦略
- **目的:** サイトで最もアクセスされるページのDB負荷を劇的に下げる。
- **TTL:** ランキングの更新は不定期なため、長めの **1時間 (3600秒)** に設定。
- **キャッシュの更新（重要）:** 新しいスコアが投稿されたり、既存のスコアが更新・削除された場合、**現在のキャッシュは古い情報になってしまう。** そのため、**DBへの書き込み処理と同時に、キャッシュを能動的に削除（無効化）する**必要がある。
### 3. 中学校生徒会HP (natyu-seitokai)

#### 3.1. キャッシュ対象
- **お知らせ一覧ページに表示される投稿リスト。**
- **各お知らせの詳細ページの内容。**

#### 3.2. キャッシュ戦略
- **目的:** 全校生徒からのアクセスが集中するページの表示を高速化し、DB負荷を軽減する。
- **TTL:** **1時間 (3600秒)**。
- **キャッシュの更新:** CPUランキングと同様。管理者によって**新しいお知らせが投稿されたり、既存のお知らせが編集・削除された場合**は、関連するキャッシュを能動的に削除する必要がある。

