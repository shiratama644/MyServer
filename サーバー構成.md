### 1. Proxmox VE ホスト構成

- **OS:** Proxmox Virtual Environment
- **CPU:** Ryzen 7 5825U (8コア/16スレッド)
- **RAM:** 32GB
- **SSD:** 1TB
-   **管理ツール:**
    -   コンテナ: LXC
    -   特別なサーバー用のコンテナ: KVM
    -   リバースプロキシ: Nginx
    -   プロセス管理: PM2
    -   キャッシュ/PubSub: Redis
    -   データベース: PostgreSQL

### 2. ネットワークアーキテクチャ

#### 2.1. ドメイン・DDNS

- **メインホスト名:** `shiratama.mydns.jp`
  - 主にパスベースルーティングで使用するメインの入り口。
- **専用ホスト名:** `seitokai.mydns.jp`
  - `seitokai`サービス専用の入り口。

#### 2.2. 外部アクセスフロー

外部からのWebアクセス (TCP:80, 443) は、以下の経路をたどります。

1. **ルーター:** すべてのアクセスを単一の**Nginxリバースプロキシ用LXCコンテナ**にポートフォワーディングします。
2. **Nginxリバースプロキシ (LXC):** 受け取ったリクエストの**ホスト名**と**URLパス**を判別し、バックエンドで稼働している適切なLXC/KVMへリクエストを転送します。

#### 2.3. ルーティング戦略

Nginxリバースプロキシは、以下の2つの戦略でリクエストを振り分けます。

- **ホスト名ベースルーティング (Hostname-based Routing):**
  - `seitokai.mydns.jp` へのアクセスは、すべて**`seitokai`用LXCコンテナ**に直接転送します。

- **パスベースルーティング (Path-based Routing):**
  - `shiratama.mydns.jp` へのアクセスは、URLパスに応じて各サービスへ転送します。
    - `shiratama.mydns.jp/` → **`portfolio`用LXCコンテナ**
    - `shiratama.mydns.jp/proxtube/` → **`proxtube`用LXCコンテナ**
    - `shiratama.mydns.jp/threefps/` → **`threefps`用LXCコンテナ**
    - `shiratama.mydns.jp/admin/` → **`admin`用LXCコンテナ**
    - (その他サービスも同様)

#### 2.4. DDNS自動更新

- **`admin`用LXCコンテナ**内で`cron`とシェルスクリプトを実行。
- 2時間ごとにMyDNS.jpへグローバルIPアドレスを自動通知します。
- 実行ログは同コンテナ内に保存し、`admin`サイトから閲覧可能にします。

### 3. ゲスト構成 (LXC & KVM)

Proxmox VE上では、各サービスを以下の独立したゲストOSとして稼働させます。

| ID (例) | 名前 | 種別 | 役割・搭載サービス | 備考 |
| :--- | :--- | :--- | :--- | :--- |
| **LXC 100** | **reverse-proxy** | LXC | **Nginx** | 外部からの全アクセスを受け付ける唯一の窓口。SSL終端も担当。 |
| **LXC 101** | **portfolio** | LXC | `portfolio` (Next.js Static) | `shiratama.mydns.jp/` のルートアクセスを担当。 |
| **LXC 102** | **seitokai** | LXC | `seitokai` (Next.js) | `seitokai.mydns.jp` の専用アクセスを担当。 |
| **LXC 103** | **youtube-proxy** | LXC | `youtube-proxy` (Next.js, Express) | |
| **LXC 104** | **3d-fps-web** | LXC | `3d-fps` のWebフロント/サーバー部 | ゲームサーバー本体(KVM)と内部通信。 |
| **LXC 105** | **discord-chat** | LXC | `discord-chat` (Next.js, Express) | |
| **LXC 106** | **cpu-ranking** | LXC | `cpu-ranking` (Next.js) | |
| **LXC 107** | **admin** | LXC | `admin` (Next.js, Express), DDNS更新 | 管理サイト。DDNS更新スクリプトを内包。 |
| **LXC 108** | **discord-bot** | LXC | `discord-bot` (Node.js) | |
| **KVM 200** | **cpp-game-server**| KVM | `3d-fps` のC++ゲームサーバー | パフォーマンスとセキュリティを重視。 |
| **KVM 201** | **database** | KVM | **PostgreSQL** | 全サービスのデータを集約・管理。 |
| **KVM 202** | **redis** | KVM | **Redis** | キャッシュ/PubSub/セッション管理。 |

### 4. 共通アプリケーション・ツール

- **プロセス管理:** 各Node.jsアプリケーションは、それぞれのLXCコンテナ内で **`PM2`** を使用して永続化・管理します。