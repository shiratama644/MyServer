-   **URLパス:** `/3d-fps/`
-   **フォルダ:** `srv/3d-fps/`
-   **概要:** Webブラウザでプレイ可能なマルチプレイヤーFPSゲーム (FFA, チームデスマッチ, バトルロイヤル)。
-   **構成:** **ハイブリッド分離型 (Frontend + Web Backend + Game Backend)**
-   **フロントエンド:** Next.js (Client)
    -   **フォルダ:** `srv/3d-fps/frontend/`
    -   **ライブラリ:** `React`, `Babylon.js` (3D描画)
    -   **機能:**
        -   ゲーム画面のレンダリング、アセット読み込み。
        -   Webサーバー(Express.js)へのHTTPリクエスト（ログイン、戦績表示など）。
        -   プレイヤーのキーボード/マウス入力を検知。
        -   ゲームサーバー(C++)とのWebSocket接続を確立し、プレイヤー操作の送信とゲーム状態の受信を行う。

-   **バックエンド:** **2つのサーバーで構成**

    -   **Webサーバー (Node.js)**
        -   **フォルダ:** `srv/3d-fps/web-server/`
        -   **技術:** Express.js
        -   **ポート (PM2):** `3003`
        -   **役割/機能:**
            -   **ユーザー認証:** プレイヤーのログイン/新規登録APIを提供。
            -   **API提供:** 戦績やランキングなど、データベースの情報を取得するAPIエンドポイントを提供。
            -   **マッチメイキング:**
                1.  プレイ待機中のプレイヤーをリスト管理。
                2.  人数が揃ったら、新しいゲームセッションを開始するようゲームサーバー(C++)に通知。
                3.  プレイヤーに対し、接続すべきゲームサーバーのIPアドレスとポート、認証用のセッショントークンを払い出す。

    -   **ゲームサーバー (C++)**
        -   **フォルダ:** `srv/3d-fps/game-server/`
        -   **技術:** C++ (C++17以降を推奨)
        -   **ポート (PM2):** `9001` (Webサーバーとは別ポート)
        -   **ビルド:** `g++` / `clang++` と `Makefile` または `CMake` でビルドした実行可能バイナリをPM2で管理。
        -   **役割/機能:**
            -   **リアルタイム通信:** WebSocket (またはWebRTC/UDP) を利用して、複数のクライアントとの持続的な接続を確立・管理。
                -   *推奨ライブラリ: `uWebSockets`, `websocketpp`, `Boost.Asio`*
            -   **ゲームロジック:** プレイヤーの移動、射撃などのアクションを処理し、当たり判定や物理演算を実行。ゲームのルール（スコア計算、勝敗判定など）を管理。
            -   **状態同期:** 全プレイヤーの最新の状態（位置、向き、HPなど）を、接続されている全クライアントに高速でブロードキャスト（サーバーティックごと）。

-   **データベース:** PostgreSQL
    -   **連携:** 主にWebサーバー(Express.js)がアクセス。ゲームサーバー(C++)も必要に応じて直接アクセス可能。
        -   *C++用推奨ライブラリ: `libpqxx`*
    -   **DB名:** `fpsgames_db`
    -   **ユーザー名:** `fpsgames_user`
    -   **保存データ:** ユーザーアカウント、ハッシュ化パスワード、戦績（キル/デス）、ランキング。

-   **ユーザー規模:**
    -   ユーザー数: 約40人
    -   同時接続数: 約20人 (10 vs 10)

-   **NOTE:**
    -   **責務の分離:** Webサーバーとゲームサーバーを分離することで、各サーバーは自身の役割に特化でき、開発と保守が容易になる。
    -   **低遅延の追求:** ゲームサーバー(C++)は、ガベージコレクションのない言語特性とマルチスレッドを活かし、極限まで低遅延を目指す。
    -   **セキュリティ:** ゲームサーバーに接続する際は、Webサーバーが発行した一時的なセッショントークンで認証を行い、不正な接続を防ぐ。
    -   **PM2管理:** `ecosystem.config.js` にて、Express.jsの起動スクリプトと、C++のコンパイル済みバイナリの両方をプロセスとして登録する。