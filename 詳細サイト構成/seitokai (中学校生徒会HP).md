-   **URLパス:** `/seitokai/`
-   **フォルダ:** `srv/seitokai/`
-   **コンセプト:** 名古屋中学校の生徒と生徒会をつなぐ、公式情報発信プラットフォーム。モダンで使いやすいUIを提供し、目安箱機能を通じて、生徒の意見を円滑に収集・反映させることを目的とする。
-   **構成:** **一体型 (Next.js + API Routes)**

---

### 1. ユーザー権限と認証

-   **認証方式:** **Googleアカウント認証のみ。** `NextAuth.js`ライブラリのGoogle Providerを利用。これにより、生徒は新しいパスワードを覚える必要がなく、学校で利用しているアカウントでシームレスにログインできる。
-   **権限レベル (Role):**
    1.  **ADMIN (管理者):** サイトの全設定、全ユーザーの権限管理、NGワードを含む目安箱の投稿者情報開示など、すべての操作が可能。
    2.  **COUNCIL (生徒会メンバー):** お知らせの投稿・編集、目安箱の内容閲覧（投稿者情報は見れない）、サイトの主要コンテンツ管理を担う。
    3.  **STUDENT (一般生徒):** サイトの閲覧に加え、ログインすることで目安箱への意見投稿が可能になる。
    4.  **GUEST (ゲスト):** ログインしていない閲覧者。コンテンツの閲覧のみ可能。
-   **権限の付与フロー:**
    -   **初期ADMIN:** `.env`ファイルに初期管理者のメールアドレスをカンマ区切りで設定 (`INITIAL_ADMIN_EMAILS=admin1@example.com,admin2@example.com`)。アプリケーションは起動時にこの設定を読み込み、該当するメールアドレスを持つユーザーがログインした際に自動的に`ADMIN`権限を付与する。
    -   **権限昇格:** `ADMIN`は管理画面から、`STUDENT`権限のユーザーを`COUNCIL`または`ADMIN`に昇格または降格させることができる。

---

### 2. UI/UX

-   **デザイン:**
    -   **テーマ:** モダンでありながら、見やすいテーマ。フォントは可読性の高いNoto Sans JPなどを採用。
    -   **レスポンシブ:** PC、タブレット、スマートフォンの全デバイスに最適化された表示。
-   **ページ構成:**
    -   **公開ページ (全ユーザー閲覧可能):**
        -   **ナビゲーション:** PCでは左側に固定サイドバー、スマートフォンではハンバーガーメニューとして表示。
        -   **ホーム (`/seitokai/`):** 最新のお知らせ3件、活動内容への導線、目安箱への案内などをカード形式で分かりやすく配置。
        -   **活動内容 (`/seitokai/activities`):** 生徒会が主催するイベントやプロジェクトを時系列またはカテゴリ別で表示。
        -   **お知らせ (`/seitokai/news`):**
            -   **UI:** お知らせの一覧ページ。1カードにつき題名・日時・文章冒頭を表示。
            -   **表示件数選択:** ページ上部に「表示件数」のドロップダウンメニュー (`5, 10, 15, 20` 件) を設置。ユーザーが選択すると、URLクエリパラメータ (`?limit=20`) が更新され、ページが再読み込みされる。この設定はページ遷移やリロード後も維持される。
        -   **お知らせ詳細 (`/seitokai/news/[id]`):** **構造化されたデータ**に基づき、統一された見やすいレイアウトでお知らせ本文を表示。
        -   **生徒会について (`/seitokai/about`):** 生徒会の理念や組織構成を紹介。
        -   **役員紹介 (`/seitokai/members`):** **役職に基づいた階層的なレイアウト**で役員を紹介。
            -   **上段:** 会長、副会長、書記、会計を役職ごとにまとめて表示。
            -   **各役職に複数人が就任している場合（例：副会長が2人）でも、1つのセクション内に横並びで表示し、レイアウトが崩れないように柔軟に対応する。**
            -   各役員はカード形式で表示し、大きなGoogleアカウントのアバター、氏名、役職、そして管理画面から登録した挨拶文を表示。
            -   **下段:** 執行部メンバーを、小さめのアバターと氏名のみでグリッド状に並べて表示。
    -   **専用画面 (要ログイン):**
        -   **管理画面 (`/seitokai/admin`):** `ADMIN`権限を持つユーザーのみアクセス可能。
        -   **生徒会画面 (`/seitokai/council`):** `COUNCIL`権限以上のユーザーがアクセス可能。

---

### 3. 主要機能

#### 3.1 目安箱機能

-   **UI (投稿側):** サイトの右下に常時表示されるフローティングアクションボタン（FAB）をクリックすると、モーダルウィンドウが開く。
-   **入力フォーム (モーダル内):**
    -   **ご意見・ご提案:** `textarea` (文字数制限は管理者専用画面のサイト設定の目安箱設定で設定可能)。入力中にリアルタイムで文字数カウンターを表示。
    -   **カテゴリ:** ドロップダウンリスト (`<select>`) で選択 (学校行事, 授業・学習, 施設・設備, 部活動, 生徒会活動, 校則・ルール, 食堂・売店, その他)。
    -   **ボタン:** 「匿名で送信する」「キャンセル」。送信ボタンは、内容が入力されるまで非活性状態とする。
-   **投稿ロジック (バックエンド):**
    1.  リクエストを受け取ると、まず投稿内容とDBの`ng_words`テーブルを照合。部分一致で検索する。
    2.  **NGワード非含有:** `suggestions`テーブルに、`user_id`を`NULL`としてデータを挿入。
    3.  **NGワード含有:** `suggestions`テーブルに、リクエスト元の`user_id`を記録し、`contains_ng_word`フラグを`true`にしてデータを挿入。
-   **閲覧 (生徒会画面 - 目安箱タブ):**
    -   **レイアウト:** 意見一覧の上部にフィルタリング用のUIエリアを設ける。
    -   **フィルタ検索機能:**
        -   **UI:**
            -   **カテゴリ:** 目安箱のカテゴリ一覧がチェックボックス形式で表示される。複数選択可能。
            -   **状態:** 「すべて」「**承認待ちのみ**」「匿名投稿のみ」を選択できるラジオボタン。
            -   **期間:** 開始日と終了日を選択できる日付ピッカーを設置。
            -   **並び替え:** 古い順と新しい順で並び替え可能。
            -   **ボタン:** 「この条件で検索」「リセット」。
        -   **挙動:** 検索ボタンを押すと、選択されたフィルター条件をクエリパラメータとしてAPIに送信し、結果を再表示する。URLに検索条件が反映されるため、ブラウザの「戻る」ボタンやURLの共有にも対応できる (`/seitokai/council/suggestions?category=school_events&status=pending_approval`)。
    -   **UI改善:**
        -   **アコーディオン形式:** 一つ一つの意見は、初期状態では「カテゴリ」「投稿日時」「内容の冒頭部分」「ステータス」のみが表示された閉じた状態。これにより、一覧性を大幅に向上させる。
        -   クリックするとドロップダウンで展開し、意見の全文が表示される。
        -   **NGワードハイライト:** `contains_ng_word`が`true`の投稿を展開した場合、本文中の該当NGワード部分が**蛍光色の黄色 (`<mark>`タグなどを使用) でハイライト**されて表示される。バックエンドはNGワードのリストもフロントに渡し、フロント側でハイライト処理を行うことで、DBにハイライト済みHTMLを保存する必要をなくす。
    -   **一覧表示と承認ワークフロー:**
        -   **承認待ち投稿の表示:** NGワードを含む「**承認待ち**」ステータスの投稿は、行全体を薄い赤色でハイライトし、「承認待ち」というステータスラベルを明示することで、レビューが必要であることを示す。
        -   **投稿者情報の表示:** NGワードを含む投稿（承認待ち・承認済み問わず）には、「投稿者情報を表示する」ボタンが表示される。このボタンは`ADMIN`権限を持つユーザーにしか見えない。クリックすると、投稿者の名前とメールアドレスがモーダルで表示される。
        -   **承認・拒否操作 (`ADMIN`専用):**
            -   `ADMIN`権限のユーザーが「承認待ち」の投稿を閲覧すると、詳細エリアに「承認する」「拒否する」の2つのボタンが表示される。`COUNCIL`権限のユーザーにはこれらのボタンは表示されない。
            -   **承認:** 「承認する」ボタンを押すと、投稿のステータスが「承認済み」に更新され、一覧でのハイライトと「承認待ち」ラベルが消え、通常の投稿と同じ見た目になる。
            -   **拒否:** 「拒否する」ボタンを押すと、「この投稿を完全に削除しますか？」という確認ダイアログが表示される。承認すると、投稿はデータベースから完全に削除される。
        -   **ページネーション:**
            -   上部に、「表示件数」というラベルと、ドロップダウンメニュー (`<select>`) を設置する。
            -   **表示件数選択:** ページ上部に「表示件数」のドロップダウンメニュー (`5, 10, 15, 20` 件) を設置。ユーザーが選択すると、URLクエリパラメータ (`?limit=20`) が更新され、ページが再読み込みされる。この設定はページ遷移やリロード後も維持される。

#### 3.2 お知らせ投稿・編集機能 (生徒会画面)

-   **コンセプト:** Markdownの手入力を廃し、**構造化された専用フォーム**に入力することで、誰でも簡単に見やすく統一された形式のお知らせを作成できるようにする。
-   **UI (投稿・編集画面):**
    -   **タイトル:** `input type="text"` (必須)
    -   **開催日:** `input type="date"` (任意項目)
    -   **場所:** `input type="text"` (任意項目)
    -   **対象:** `input type="text"` (例: 全校生徒、1年生のみ) (任意項目)
    -   **本文:** Markdown記法に対応したリッチテキストエディタ。ここには純粋な説明文を入力する。
    -   **添付ファイル:** ファイルアップロードコンポーネント。複数ファイル（PDF, Word, Excelなど）を添付可能。
    -   **担当:** `input type="text"` (例: 生徒会執行部、文化祭実行委員会) (任意項目)
    -   **公開ステータス:** 「下書きとして保存」「すぐに公開」を選択できるラジオボタン。
    -   **ボタン:** 「保存する」「プレビュー」「キャンセル」。
-   **表示 (お知らせ詳細ページ):**
    -   投稿フォームで入力された各項目が、**決められたテンプレート**に従って美しくレイアウトされる。
    -   例：ページ上部にタイトル、その下に開催日や場所などの情報がまとまっている。その下に本文が表示され、最下部に添付ファイル（画像や動画の場合はプレビューあり）へのリンクと担当者名が記載される。

#### 3.3 管理者機能 (管理画面)

-   **UI:** タブ形式のダッシュボード（サイト設定 / アカウント管理 / 生徒会役員管理 / NGワード管理）。
-   **機能:**
    -   **サイト設定:**
        -   **活動内容の管理:** 「活動内容」ページに表示するコンテンツ（タイトル、説明文、画像など）をCRUD操作できる。
        -   **生徒会について編集:** 「生徒会について」ページに表示される各セクションの文章を整理されたエディタで編集。
        -   **目安箱設定:** 目安箱の投稿文字数制限を数値で設定。
    -   **アカウント管理:**
        -   **UI:** 「氏名またはメールアドレスで検索」と書かれた検索ボックスと検索ボタンを設置。
        -   **検索フロー:**
            1.  管理者が検索ボックスにキーワード（例: `佐藤` or `sato@example.com`）を入力して検索。
            2.  バックエンドは`users`テーブルの`name`カラムと`email`カラムに対し、部分一致（`LIKE '%keyword%'`）で検索を実行。
            3.  該当するユーザーが複数いる場合はリストで表示。ユーザーが1人の場合はそのユーザーの詳細情報を表示。
            4.  詳細情報欄には、ユーザーの名前、メールアドレス、現在の権限が表示される。
            5.  その下に、権限を変更するためのドロップダウンリスト（STUDENT, COUNCIL, ADMIN）と「更新」ボタン、および赤文字の「このアカウントを強制退会させる」ボタンを設置。
            6.  「強制退会」ボタンクリック時には、「本当に退会させますか？この操作は元に戻せません。」という確認ダイアログを表示し、誤操作を防ぐ。
    -   **生徒会役員管理:**
        -   **目的:** 生徒会メンバーの中から役職者を任命し、役員紹介ページに反映させる。
        -   **UI:**
            1.  「役員を追加」ボタンを押すと、役員追加用のUIが表示される。
            2.  氏名またはメールアドレスでユーザーを検索する。（検索対象は`role`が`COUNCIL`以上のユーザーに限定）
            3.  検索して見つかったユーザーに対し、役職（会長, 副会長, 書記, 会計, 執行部）をドロップダウンで選択し、挨拶文（会長〜会計のみ）を入力するフォームを表示。
            4.  「役員として登録」ボタンで保存。
        -   **一覧表示:** 現在登録されている役員がリスト表示され、役職の変更や役員からの削除が可能。
    -   **目安箱NGワード管理:**
        -   現在登録されているNGワードを一覧表示。
        -   新しいワードを追加する入力フォームと、各ワードを削除するボタンを設置。

---

### 4. API設計 (Next.js API Routes)

#### **認証 (Auth)**

-   **Endpoint**: `/api/auth/*`
    -   **概要**: ユーザーのGoogleアカウントによるログイン、ログアウト、セッション状態の確認など、認証に関するすべての処理を担います。
    -   **仕様書との関連**: `1. ユーザー権限と認証` > `認証方式`
    -   **詳細**: このエンドポイント群は `NextAuth.js` ライブラリが規約に基づいて自動的に生成・管理します。フロントエンドはNextAuthの提供する`signIn`, `signOut`, `useSession`といったフックやメソッドを利用して、これらのAPIと透過的に通信します。`.env`ファイルに設定された`INITIAL_ADMIN_EMAILS`に基づき、初回ログイン時に特定のユーザーへ`ADMIN`権限を付与するロジックは、NextAuthの`callbacks`（特に`signIn`や`jwt`）内で実装します。

#### **公開情報 (Public Access)**

サイト訪問者（ゲスト含む）が誰でもアクセスできる、閲覧専用のAPI群です。

-   **Endpoint**: `GET /api/public/posts`
    -   **概要**: 公開状態(`published`)の「お知らせ」を、ページネーション形式で一覧取得します。
    -   **仕様書との関連**:
        -   `2. UI/UX` > `お知らせ (/seitokai/news)`: 一覧ページのデータソースとなります。
        -   `2. UI/UX` > `ホーム (/seitokai/)`: 最新3件のお知らせを表示するために `?limit=3` のように利用します。
    -   **アクセス権限**: `GUEST` (全ユーザー)
    -   **クエリパラメータ**:
        -   `page` (number, optional, default: 1): 取得するページ番号。
        -   `limit` (number, optional, default: 10): 1ページあたりの表示件数。仕様書のドロップダウンメニューに対応します。
    -   **レスポンス (200 OK)**:
        ```json
        {
          "posts": [
            {
              "id": 1,
              "title": "体育祭のお知らせ",
              "summary": "本文の冒頭...",
              "event_date": "2023-10-30",
              "created_at": "2023-10-01T12:00:00Z"
            }
          ],
          "pagination": {
            "totalItems": 25,
            "totalPages": 3,
            "currentPage": 1,
            "limit": 10
          }
        }
        ```

-   **Endpoint**: `GET /api/public/posts/[id]`
    -   **概要**: 指定されたIDを持つ単一の「お知らせ」の詳細な構造化データを取得します。
    -   **仕様書との関連**: `2. UI/UX` > `お知らせ詳細 (/seitokai/news/[id])`: このページの表示に必要なすべてのデータを提供します。
    -   **アクセス権限**: `GUEST` (全ユーザー)
    -   **レスポンス (200 OK)**:
        ```json
        {
          "id": 1,
          "title": "体育祭のお知らせ",
          "content": "## 開催概要\n\n**日時**: 10月30日(月) 9:00〜...",
          "author": { "name": "生徒 太郎" },
          "status": "published",
          "event_date": "2023-10-30",
          "location": "本校グラウンド",
          "target_audience": "全校生徒",
          "person_in_charge": "体育祭実行委員会",
          "attachments": [
            { "id": 1, "original_filename": "競技一覧.pdf", "url": "/api/files/download/1" }
          ],
          "created_at": "2023-10-01T12:00:00Z",
          "updated_at": "2023-10-02T15:30:00Z"
        }
        ```

-   **Endpoint**: `GET /api/public/council-members`
    -   **概要**: 「役員紹介」ページに表示するための、全役員の情報を取得します。バックエンド側で仕様書に定義された表示レイアウト（上段の主要役員、下段の執行部）に合わせてデータを整形し、フロントエンドがそのまま描画できる構造で返却します。
    -   **仕様書との関連**: `2. UI/UX` > `役員紹介 (/seitokai/members)`: このページの階層的レイアウトを完全にサポートします。
    -   **アクセス権限**: `GUEST` (全ユーザー)
    -   **レスポンス (200 OK)**:
        ```json
        {
          "main_officers": [
            { "role": "PRESIDENT", "name": "生徒 会長", "image": "...", "greeting": "..." },
            { "role": "VICE_PRESIDENT", "name": "生徒 副会長1", "image": "...", "greeting": "..." },
            { "role": "VICE_PRESIDENT", "name": "生徒 副会長2", "image": "...", "greeting": "..." }
          ],
          "executives": [
            { "role": "EXECUTIVE", "name": "執行部員1", "image": "..." },
            { "role": "EXECUTIVE", "name": "執行部員2", "image": "..." }
          ]
        }
        ```

#### **目安箱 (Suggestions)**

-   **Endpoint**: `POST /api/suggestions`
    -   **概要**: ログインしている生徒が目安箱に新しい意見を投稿します。このAPIのバックエンドロジックが、投稿の匿名性を内容に応じて自動的に決定する、本システムの根幹機能の一つです。
    -   **仕様書との関連**: `3.1 目安箱機能` > `UI (投稿側)` および `投稿ロジック (バックエンド)`
    -   **アクセス権限**: `STUDENT` 以上
    -   **リクエストボディ**:
        ```json
        {
          "content": "string",
          "category": "string"
        }
        ```
    -   **サーバー側処理フロー**:
        1.  リクエストヘッダーのセッション情報から、投稿者の`user_id`を特定します。
        2.  リクエストボディの`content`と、`ng_words`テーブルに登録されている全単語を照合し、部分一致するものがあるかチェックします。
        3.  **【NGワード非含有時】**: `suggestions`テーブルにレコードを挿入します。この際、`user_id`カラムには`NULL`を、`contains_ng_word`には`false`を、`status`には`'public'`を設定します。これにより、投稿は自動的に匿名化されます。
        4.  **【NGワード含有時】**: `suggestions`テーブルにレコードを挿入します。この際、`user_id`カラムには手順1で特定した投稿者の`user_id`を、`contains_ng_word`には`true`を、`status`には`'pending_approval'`を設定します。これにより、投稿者情報が記録され、管理者のレビュー対象となります。
    -   **レスポンス (201 Created)**:
        ```json
        { "message": "ご意見ありがとうございます。生徒会で確認させていただきます。" }
        ```

#### **生徒会専用機能 (Council Access)**

`COUNCIL`権限以上のユーザーが、コンテンツ管理のために利用するAPI群です。

-   **Endpoint**: `GET /api/council/suggestions`
    -   **概要**: 「生徒会画面」の目安箱タブで、投稿された意見をフィルタリング、ソート、ページネーション付きで一覧取得します。
    -   **仕様書との関連**: `3.1 目安箱機能` > `閲覧 (生徒会画面 - 目安箱タブ)`: このセクションの全機能（フィルタ、UI改善、一覧表示）を実現するためのデータを提供します。
    -   **アクセス権限**: `COUNCIL` 以上
    -   **クエリパラメータ**:
        -   `category` (string, optional): `school_events,club_activities` のようにカンマ区切りで複数指定可能。
        -   `status` (string, optional): `'pending_approval'` (承認待ちのみ) または `'anonymous'` (匿名投稿のみ) を指定。
        -   `startDate` / `endDate` (string, optional): `YYYY-MM-DD`形式での期間指定。
        -   `sort` (string, optional): `'asc'` (古い順) or `'desc'` (新しい順)。
        -   `page` (number, optional), `limit` (number, optional)。
    -   **レスポンス (200 OK)**:
        ```json
        {
          "suggestions": [
            {
              "id": 1,
              "content": "会長は死ね。",
              "category": "その他",
              "status": "pending_approval",
              "contains_ng_word": true,
              "matched_ng_words": ["死ね"],
              "created_at": "2023-10-27T10:00:00Z",
              "user": { "name": "山田 太郎", "email": "yamada@example.com" }
            }
          ],
          "pagination": { "totalItems": 50, "totalPages": 5, "currentPage": 1 }
        }
        ```
    -   **特記事項**: このAPIは、リクエスト元のユーザー権限を判別します。`ADMIN`であれば投稿者情報(`user`オブジェクト)をレスポンスに含めますが、`COUNCIL`であれば`user`キー自体を含めません。これにより、仕様書通りの情報アクセス制御を実現します。

-   **Endpoint**: `POST /api/council/posts`
    -   **概要**: 新しい「お知らせ」を下書きまたは公開状態で作成します。添付ファイルも同時にアップロード可能です。
    -   **仕様書との関連**: `3.2 お知らせ投稿・編集機能`
    -   **アクセス権限**: `COUNCIL` 以上
    -   **リクエスト形式**: `multipart/form-data`
    -   **リクエストボディ**:
        -   `title`, `content`, `status`, `event_date`などのフォームデータ。
        -   `files`: 添付ファイルのバイナリデータ。
    -   **レスポンス (201 Created)**: `{ "id": 123, "message": "お知らせを作成しました。" }`

-   **Endpoint**: `PUT /api/council/posts/[id]`
    -   **概要**: 既存の「お知らせ」を更新します。
    -   **アクセス権限**: `COUNCIL` 以上
    -   **レスポンス (200 OK)**: `{ "id": 123, "message": "お知らせを更新しました。" }`

-   **Endpoint**: `DELETE /api/council/posts/[id]`
    -   **概要**: 既存の「お知らせ」を削除します。
    -   **アクセス権限**: `COUNCIL` 以上
    -   **レスポンス (204 No Content)**: ボディなし。

#### **管理者専用機能 (Admin Access)**

`ADMIN`権限を持つユーザーのみがアクセス可能な、サイトの最高レベルの管理API群です。

-   **Endpoint**: `PATCH /api/admin/suggestions/[id]/approve`
    -   **概要**: NGワードを含む「承認待ち」の投稿を「承認済み」状態に更新します。
    -   **仕様書との関連**: `3.1 目安箱機能` > `承認・拒否操作` の「承認」ボタンに対応します。
    -   **アクセス権限**: `ADMIN` のみ
    -   **レスポンス (200 OK)**: `{ "message": "投稿を承認しました。" }`

-   **Endpoint**: `DELETE /api/admin/suggestions/[id]`
    -   **概要**: 目安箱の投稿を「拒否」し、データベースから完全に削除します。
    -   **仕様書との関連**: `3.1 目安箱機能` > `承認・拒否操作` の「拒否」ボタンに対応します。
    -   **アクセス権限**: `ADMIN` のみ
    -   **レスポンス (204 No Content)**: ボディなし。

-   **Endpoint**: `GET /api/admin/users`
    -   **概要**: 全ユーザーを検索、または一覧取得します。
    -   **仕様書との関連**: `3.3 管理者機能` > `アカウント管理` および `生徒会役員管理` でのユーザー検索機能。
    -   **アクセス権限**: `ADMIN` のみ
    -   **クエリパラメータ**: `q` (検索語), `role` (権限), `is_officer` (役職者フラグ)
    -   **レスポンス (200 OK)**: ユーザーオブジェクトの配列。

-   **Endpoint**: `PUT /api/admin/users/[id]`
    -   **概要**: 特定ユーザーの権限(`role`)、役職(`council_role`)、挨拶文(`greeting`)を更新します。権限昇格や役員任命・変更に使用します。
    -   **仕様書との関連**: `3.3 管理者機能` > `アカウント管理` の権限変更、および `生徒会役員管理` の役員登録・変更。
    -   **アクセス権限**: `ADMIN` のみ
    -   **リクエストボディ**: `{ "role": "COUNCIL", "council_role": "VICE_PRESIDENT", "greeting": "..." }`
    -   **レスポンス (200 OK)**: 更新後のユーザー情報。

-   **Endpoint**: `DELETE /api/admin/users/[id]`
    -   **概要**: 特定ユーザーを強制退会させます（レコードを削除）。
    -   **仕様書との関連**: `3.3 管理者機能` > `アカウント管理` の「強制退会」ボタン。
    -   **アクセス権限**: `ADMIN` のみ
    -   **レスポンス (204 No Content)**: ボディなし。

-   **Endpoint**: `GET /api/admin/settings`, `PUT /api/admin/settings`
    -   **概要**: サイト設定（目安箱の文字数制限など）を取得・更新します。
    -   **仕様書との関連**: `3.3 管理者機能` > `サイト設定`
    -   **アクセス権限**: `ADMIN` のみ

-   **Endpoint**: `GET /api/admin/ngwords`, `POST /api/admin/ngwords`, `DELETE /api/admin/ngwords/[id]`
    -   **概要**: 目安箱のNGワードをCRUD（作成、読み取り、削除）操作します。
    -   **仕様書との関連**: `3.3 管理者機能` > `目安箱NGワード管理`
    -   **アクセス権限**: `ADMIN` のみ

---

### 5. データベース (PostgreSQL)

-   **DB名:** `seitokai_db`
-   **ユーザー名:** `seitokai_user`
-   **スキーマ設計:**
    ##### **`users` テーブル**

    -   **概要**:
        サイトを利用する全ユーザー（生徒、生徒会、管理者）の基本情報と、権限、役職情報を格納します。Google認証で得られる情報をベースに、このアプリケーション独自の役割（Role）と役職（Council Role）を追加で管理します。

    -   **カラム定義**:
        -   `id`
            -   **データ型**: `TEXT`
            -   **制約**: `PRIMARY KEY`
            -   **説明**: ユーザーの一意な識別子。NextAuth.jsが生成するCUIDやUUIDを想定しています。
        -   `name`
            -   **データ型**: `VARCHAR(255)`
            -   **制約**: `NULL`許容
            -   **説明**: ユーザーの氏名。Googleアカウントから取得します。
        -   `email`
            -   **データ型**: `VARCHAR(255)`
            -   **制約**: `NOT NULL`, `UNIQUE`
            -   **説明**: ユーザーのメールアドレス。ログインやユーザー検索のキーとなります。
        -   `emailVerified`
            -   **データ型**: `TIMESTAMP WITH TIME ZONE`
            -   **制約**: `NULL`許容
            -   **説明**: NextAuth.jsが使用する、メールアドレスの認証日時。
        -   `image`
            -   **データ型**: `TEXT`
            -   **制約**: `NULL`許容
            -   **説明**: Googleアカウントのプロフィール画像のURL。
        -   `role`
            -   **データ型**: `VARCHAR(10)`
            -   **制約**: `NOT NULL`, `DEFAULT 'STUDENT'`
            -   **説明**: サイト内でのアクセス権限を示す役割。`'ADMIN'`, `'COUNCIL'`, `'STUDENT'` のいずれかの文字列を格納します。
        -   `council_role`
            -   **データ型**: `VARCHAR(20)`
            -   **制約**: `NULL`許容
            -   **説明**: 生徒会内での具体的な役職を示します。役職を持たないユーザーは `NULL` となります。アプリケーション側で定義された役職定数（例: `'PRESIDENT'`, `'VICE_PRESIDENT'`, `'SECRETARY'`, `'TREASURER'`, `'EXECUTIVE'`）のいずれかの文字列を格納します。
        -   `greeting`
            -   **データ型**: `TEXT`
            -   **制約**: `NULL`許容
            -   **説明**: 役員紹介ページに表示される挨拶文。仕様上、会長・副会長・書記・会計の役職を持つユーザーのみが設定します。

    -   **インデックス**:
        -   `email`: `UNIQUE`制約により自動で作成されますが、ログイン時の検索で必須です。
        -   `name`: 管理画面での氏名による部分一致検索のパフォーマンスを向上させるために設定します。
        -   `role`: 特定の権限を持つユーザー（例: `COUNCIL`以上）を一覧表示する際の検索パフォーマンスを向上させるために設定します。
    ##### **`posts` テーブル**

    -   **概要**:
        「お知らせ」ページの各記事データを格納します。仕様書にある通り、タイトルや本文だけでなく、開催日や場所といった構造化された情報もカラムとして保持します。

    -   **カラム定義**:
        -   `id`
            -   **データ型**: `SERIAL`
            -   **制約**: `PRIMARY KEY`
            -   **説明**: お知らせ記事の一意な連番ID。
        -   `title`
            -   **データ型**: `VARCHAR(255)`
            -   **制約**: `NOT NULL`
            -   **説明**: お知らせのタイトル。
        -   `content`
            -   **データ型**: `TEXT`
            -   **制約**: `NOT NULL`
            -   **説明**: お知らせの本文。Markdown記法に対応したリッチテキストエディタからの入力を想定します。
        -   `author_id`
            -   **データ型**: `TEXT`
            -   **制約**: `NULL`許容, `REFERENCES users(id) ON DELETE SET NULL`
            -   **説明**: 記事を作成したユーザーのID。作成者が退会した場合でも記事は残るように、`ON DELETE SET NULL` を設定します。
        -   `status`
            -   **データ型**: `VARCHAR(20)`
            -   **制約**: `NOT NULL`, `DEFAULT 'draft'`
            -   **説明**: 記事の公開状態。`'draft'` (下書き) または `'published'` (公開済み) のいずれかを格納します。
        -   `event_date`
            -   **データ型**: `DATE`
            -   **制約**: `NULL`許容
            -   **説明**: お知らせで告知されるイベントの開催日。
        -   `location`
            -   **データ型**: `VARCHAR(255)`
            -   **制約**: `NULL`許容
            -   **説明**: イベントの開催場所。
        -   `target_audience`
            -   **データ型**: `VARCHAR(255)`
            -   **制約**: `NULL`許容
            -   **説明**: お知らせの対象者（例: 全校生徒, 1年生のみ）。
        -   `person_in_charge`
            -   **データ型**: `VARCHAR(255)`
            -   **制約**: `NULL`許容
            -   **説明**: お知らせ内容の担当者・担当部署（例: 生徒会執行部）。
        -   `created_at`
            -   **データ型**: `TIMESTAMP WITH TIME ZONE`
            -   **制約**: `NOT NULL`, `DEFAULT CURRENT_TIMESTAMP`
            -   **説明**: レコード作成日時。
        -   `updated_at`
            -   **データ型**: `TIMESTAMP WITH TIME ZONE`
            -   **制約**: `NOT NULL`, `DEFAULT CURRENT_TIMESTAMP`
            -   **説明**: レコード最終更新日時。アプリケーション側で更新時にタイムスタンプを更新するトリガーまたはロジックが必要です。
    ##### **`attachments` テーブル**

    -   **概要**:
        `posts` テーブルに紐づく添付ファイルのメタデータを管理します。一つの投稿に複数のファイルを添付できる設計です。

    -   **カラム定義**:
        -   `id`
            -   **データ型**: `SERIAL`
            -   **制約**: `PRIMARY KEY`
            -   **説明**: 添付ファイルの一意な連番ID。
        -   `post_id`
            -   **データ型**: `INTEGER`
            -   **制約**: `NOT NULL`, `REFERENCES posts(id) ON DELETE CASCADE`
            -   **説明**: 紐づくお知らせ記事のID。親となる記事が削除された場合、関連する添付ファイル情報も自動的に削除されるよう `ON DELETE CASCADE` を設定します。
        -   `file_path`
            -   **データ型**: `VARCHAR(512)`
            -   **制約**: `NOT NULL`
            -   **説明**: アップロードされたファイルのサーバー上の保存パス、またはクラウドストレージ(S3等)のURL。
        -   `original_filename`
            -   **データ型**: `VARCHAR(255)`
            -   **制約**: `NOT NULL`
            -   **説明**: ユーザーがアップロードした際の元のファイル名。ダウンロード時に使用します。
        -   `mime_type`
            -   **データ型**: `VARCHAR(100)`
            -   **制約**: `NOT NULL`
            -   **説明**: ファイルの種類を示すMIMEタイプ（例: `application/pdf`, `image/jpeg`）。
        -   `uploaded_at`
            -   **データ型**: `TIMESTAMP WITH TIME ZONE`
            -   **制約**: `NOT NULL`, `DEFAULT CURRENT_TIMESTAMP`
            -   **説明**: ファイルがアップロードされた日時。
    #### **`suggestions` テーブル**

    -   **概要**:
        目安箱に投稿された意見をすべて格納します。匿名投稿、NGワードの有無、承認状態などを管理するためのカラムを持ちます。

    -   **カラム定義**:
        -   `id`
            -   **データ型**: `SERIAL`
            -   **制約**: `PRIMARY KEY`
            -   **説明**: 投稿された意見の一意な連番ID。
        -   `content`
            -   **データ型**: `TEXT`
            -   **制約**: `NOT NULL`
            -   **説明**: 投稿された意見の本文。
        -   `category`
            -   **データ型**: `VARCHAR(50)`
            -   **制約**: `NOT NULL`
            -   **説明**: 投稿時に選択されたカテゴリ。
        -   `user_id`
            -   **データ型**: `TEXT`
            -   **制約**: `NULL`許容, `REFERENCES users(id) ON DELETE SET NULL`
            -   **説明**: 投稿したユーザーのID。「匿名で送信する」が選択された場合は `NULL` となります。投稿者が退会した場合でも投稿内容は残るように `ON DELETE SET NULL` を設定します。
        -   `contains_ng_word`
            -   **データ型**: `BOOLEAN`
            -   **制約**: `NOT NULL`, `DEFAULT false`
            -   **説明**: 投稿内容にNGワードが含まれているかを示すフラグ。`true` の場合、承認ワークフローの対象となります。
        -   `status`
            -   **データ型**: `VARCHAR(20)`
            -   **制約**: `NOT NULL`
            -   **説明**: 投稿の承認状態。`'public'` (NGワードなしの通常投稿), `'pending_approval'` (NGワードを含み承認待ち), `'approved'` (NGワードを含んでいたが管理者が承認) のいずれかを格納します。
        -   `created_at`
            -   **データ型**: `TIMESTAMP WITH TIME ZONE`
            -   **制約**: `NOT NULL`, `DEFAULT CURRENT_TIMESTAMP`
            -   **説明**: 投稿日時。

    -   **インデックス**:
        -   `category`: カテゴリによる絞り込み検索のパフォーマンスを向上させます。
        -   `status`: 「承認待ちのみ」などの状態による絞り込み検索のパフォーマンスを向上させます。
        -   `created_at`: 期間指定や並び替えのパフォーマンスを向上させます。
    ##### **`settings` テーブル**

    -   **概要**:
        サイト全体に関わる設定値をキーと値のペアで管理します。これにより、ハードコーディングを避け、管理画面から動的に設定変更が可能になります。

    -   **カラム定義**:
        -   `key`
            -   **データ型**: `VARCHAR(50)`
            -   **制約**: `PRIMARY KEY`
            -   **説明**: 設定項目の一意なキー（例: `suggestion_char_limit`）。
        -   `value`
            -   **データ型**: `TEXT`
            -   **制約**: `NOT NULL`
            -   **説明**: 設定項目の値。
    #### **`ng_words` テーブル**

    -   **概要**:
        目安箱の投稿内容をチェックするためのNGワードリストを管理します。

    -   **カラム定義**:
        -   `id`
            -   **データ型**: `SERIAL`
            -   **制約**: `PRIMARY KEY`
            -   **説明**: NGワードの一意な連番ID。
        -   `word`
            -   **データ型**: `VARCHAR(100)`
            -   **制約**: `NOT NULL`, `UNIQUE`
            -   **説明**: 登録するNGワード。重複を許さないように `UNIQUE` 制約を設けます。